// --------------------------------------------------------------------------------------------------
// This file was automatically generated by J2CS Translator (http://j2cstranslator.sourceforge.net/). 
// Version 1.3.6.20110331_01     
//
// ${CustomMessageForDisclaimer}                                                                             
// --------------------------------------------------------------------------------------------------
 /// <summary>
/// Copyright (C) 2017-2018 Regents of the University of California.
/// </summary>
///
namespace net.named_data.jndn.security.v2 {
	
	using ILOG.J2CsMapping.Util.Logging;
	using System;
	using System.Collections;
	using System.ComponentModel;
	using System.IO;
	using System.Runtime.CompilerServices;
	using net.named_data.jndn;
	
	/// <summary>
	/// The InterestValidationState class extends ValidationState to hold the
	/// validation state for an Interest packet.
	/// </summary>
	///
	public class InterestValidationState : ValidationState {
		/// <summary>
		/// Create an InterestValidationState for the Data packet.
		/// The caller must ensure that state instance is valid until validation
		/// finishes (i.e., until validateCertificateChain() and
		/// validateOriginalPacket() have been called).
		/// </summary>
		///
		/// <param name="interest">The Interest packet being validated, which is copied.</param>
		/// <param name="successCallback"></param>
		/// <param name="failureCallback">Interest validation, where error is a ValidationError.</param>
		public InterestValidationState(Interest interest,
				InterestValidationSuccessCallback successCallback,
				InterestValidationFailureCallback failureCallback) {
			interest_ = interest;
			successCallback_ = successCallback;
			failureCallback_ = failureCallback;
	
			if (successCallback_ == null)
				throw new ArgumentException("The successCallback is null");
			if (failureCallback_ == null)
				throw new ArgumentException("The failureCallback is null");
		}
	
		public override void fail(ValidationError error) {
			logger_.log(ILOG.J2CsMapping.Util.Logging.Level.FINE, "" + error);
			try {
				failureCallback_.failureCallback(interest_, error);
			} catch (Exception exception) {
				logger_.log(ILOG.J2CsMapping.Util.Logging.Level.SEVERE, "Error in failureCallback", exception);
			}
			setOutcome(false);
		}
	
		/// <summary>
		/// Get the original Interest packet being validated which was given to the
		/// constructor.
		/// </summary>
		///
		/// <returns>The original Interest packet.</returns>
		public Interest getOriginalInterest() {
			return interest_;
		}
	
		public override void verifyOriginalPacket_(CertificateV2 trustedCertificate) {
			if (net.named_data.jndn.security.VerificationHelpers.verifyInterestSignature(interest_,
					trustedCertificate)) {
				logger_.log(ILOG.J2CsMapping.Util.Logging.Level.FINE, "OK signature for interest `{0}`",
						interest_.getName().toUri());
				try {
					successCallback_.successCallback(interest_);
				} catch (Exception exception) {
					logger_.log(ILOG.J2CsMapping.Util.Logging.Level.SEVERE, "Error in successCallback", exception);
				}
				setOutcome(true);
			} else
				fail(new ValidationError(net.named_data.jndn.security.v2.ValidationError.INVALID_SIGNATURE,
						"Invalid signature of interest `"
								+ interest_.getName().toUri() + "`"));
		}
	
		public override void bypassValidation_() {
			logger_.log(ILOG.J2CsMapping.Util.Logging.Level.FINE,
					"Signature verification bypassed for interest `{0}`", interest_
							.getName().toUri());
			try {
				successCallback_.successCallback(interest_);
			} catch (Exception exception) {
				logger_.log(ILOG.J2CsMapping.Util.Logging.Level.SEVERE, "Error in successCallback", exception);
			}
			setOutcome(true);
		}
	
		private readonly Interest interest_;
		private readonly InterestValidationSuccessCallback successCallback_;
		private readonly InterestValidationFailureCallback failureCallback_;
		private static readonly Logger logger_ = ILOG.J2CsMapping.Util.Logging.Logger
				.getLogger(typeof(InterestValidationState).FullName);
	}
}
